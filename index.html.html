
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Sales Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #e0f7fa; /* icy blue */
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin: 20px;
      color: #00363a;
    }
    .upload {
      margin-bottom: 20px;
    }
    .dashboard {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      gap: 20px;
    }
    .card {
      width: 90%;
      max-width: 1200px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    .card h2 {
      text-align: center;
      color: #004d40;
    }
    .chart {
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>
  <h1>Interactive Sales Dashboard</h1>
  <div class="upload">
    <input type="file" id="fileInput" accept=".json,.txt,.ndjson" />
  </div>
  <div class="dashboard">
    <div class="card">
      <h2>1) Sales by Category / Product</h2>
      <div id="categoryChart" class="chart"></div>
    </div>
    <div class="card">
      <h2>2) Sales Trend Over Time</h2>
      <div id="trendChart" class="chart"></div>
    </div>
    <div class="card">
      <h2>3) Order Status Breakdown</h2>
      <div id="statusChart" class="chart"></div>
    </div>
    <div class="card">
      <h2>4) Sales by Customer Location</h2>
      <div id="locationChart" class="chart"></div>
    </div>
    <div class="card">
      <h2>5) Sales by Payment Method</h2>
      <div id="paymentChart" class="chart"></div>
    </div>
  </div>

  <script>
    function toNumber(x) { const n = Number(x); return Number.isFinite(n) ? n : 0; }

    function parseDateFlexible(s) {
      if (!s) return null;
      const str = String(s).trim();
      let m = str.match(/^([0-3]?\d)[-/]([0-1]?\d)[-/](\d{2}|\d{4})$/);
      if (m) {
        let [_, dd, mm, yy] = m; dd = +dd; mm = +mm; let yyyy = +yy;
        if (yy.length === 2) { yyyy += (yyyy >= 70 ? 1900 : 2000); }
        return new Date(yyyy, mm - 1, dd);
      }
      m = str.match(/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/);
      if (m) return new Date(+m[1], +m[2]-1, +m[3]);
      const d = new Date(str);
      return isNaN(d) ? null : d;
    }

    function by(arr, keyFn) {
      const map = new Map();
      for (const item of arr) {
        const k = keyFn(item);
        if (k == null) continue;
        map.set(k, (map.get(k) || 0) + (item.__sales || 0));
      }
      return map;
    }

    function readLocalFile(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onerror = () => reject(reader.error);
        reader.onload = () => resolve(reader.result);
        reader.readAsText(file);
      });
    }

    function smartParseJSON(text) {
      try {
        const obj = JSON.parse(text);
        if (Array.isArray(obj)) return obj;
        if (obj && typeof obj === 'object') return [obj];
      } catch (_) {}
      const rows = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      const out = [];
      for (const line of rows) {
        try { out.push(JSON.parse(line)); } catch (e) {}
      }
      return out;
    }

    function normalizeRecord(r) {
      const price = toNumber(r.Price ?? r.UnitPrice ?? r.price);
      const qty = toNumber(r.Quantity ?? r.Qty ?? r.quantity ?? 1);
      const totalProvided = toNumber(r['Total Sales'] ?? r.Total ?? r.total);
      const sales = totalProvided > 0 ? totalProvided : price * qty;
      return { ...r, __sales: sales };
    }

    function plotCategory(data) {
      const map = by(data, d => d.Category || d.Product || 'Unknown');
      Plotly.newPlot('categoryChart', [{
        type: 'bar',
        x: Array.from(map.keys()),
        y: Array.from(map.values())
      }], { title: 'Sales by Category/Product', autosize: true });
    }

    function plotTrend(data) {
      const daily = new Map();
      for (const d of data) {
        const dt = parseDateFlexible(d.Date);
        if (!dt) continue;
        const key = dt.toISOString().slice(0,10);
        daily.set(key, (daily.get(key) || 0) + (d.__sales || 0));
      }
      const dates = Array.from(daily.keys()).sort();
      const vals = dates.map(k => daily.get(k));
      Plotly.newPlot('trendChart', [{
        type: 'scatter',
        mode: 'lines+markers',
        x: dates, y: vals
      }], { title: 'Sales Trend Over Time', autosize: true });
    }

    function plotStatus(data) {
      const map = by(data, d => d.Status || 'Unknown');
      Plotly.newPlot('statusChart', [{
        type: 'pie',
        labels: Array.from(map.keys()),
        values: Array.from(map.values())
      }], { title: 'Order Status Breakdown', autosize: true });
    }

    function plotLocation(data) {
      const map = by(data, d => d['Customer Location'] || 'Unknown');
      Plotly.newPlot('locationChart', [{
        type: 'bar',
        x: Array.from(map.keys()),
        y: Array.from(map.values())
      }], { title: 'Sales by Location', autosize: true });
    }

    function plotPayment(data) {
      const map = by(data, d => d['Payment Method'] || 'Unknown');
      Plotly.newPlot('paymentChart', [{
        type: 'bar',
        x: Array.from(map.keys()),
        y: Array.from(map.values())
      }], { title: 'Sales by Payment Method', autosize: true });
    }

    function renderAll(raw) {
      const data = raw.map(normalizeRecord);
      plotCategory(data);
      plotTrend(data);
      plotStatus(data);
      plotLocation(data);
      plotPayment(data);
    }

    document.getElementById('fileInput').addEventListener('change', async (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      try {
        const text = await readLocalFile(file);
        const parsed = smartParseJSON(text);
        if (!Array.isArray(parsed) || parsed.length === 0) {
          alert('Could not parse data. Ensure JSON array or NDJSON format.');
          return;
        }
        renderAll(parsed);
      } catch (err) {
        alert('Failed to read file: ' + err.message);
      }
    });

    // Demo data before upload
    const demo = [
      {"Order ID":"ORD0001","Date":"14-03-25","Product":"Running Shoes","Category":"Footwear","Price":60,"Quantity":3,"Total Sales":180,"Customer Location":"New York","Payment Method":"Debit Card","Status":"Cancelled"},
      {"Order ID":"ORD0002","Date":"15-03-25","Product":"Trail Shoes","Category":"Footwear","Price":80,"Quantity":1,"Customer Location":"San Francisco","Payment Method":"UPI","Status":"Completed"},
      {"Order ID":"ORD0003","Date":"16-03-25","Product":"T-Shirt","Category":"Apparel","Price":20,"Quantity":5,"Customer Location":"Austin","Payment Method":"Credit Card","Status":"Completed"}
    ];
    renderAll(demo);
  </script>
</body>
</html>
